<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>WinGo Ultimate</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { 
            --p-red: #ff4d4d; --p-green: #4cd964; --p-violet: #b666d2; 
            --theme-grad: linear-gradient(90deg, #ff4d4d, #ff8e8e);
        }
        body { background: #f5f5f5; font-family: 'Segoe UI', sans-serif; margin: 0; user-select: none; }

        /* Header & Tabs */
        .header { background: var(--theme-grad); padding: 15px; color: white; display: flex; align-items: center; justify-content: space-between; }
        .mode-tabs { display: flex; background: white; margin: 10px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .mode-tab { flex: 1; padding: 12px; text-align: center; font-size: 14px; font-weight: 600; color: #666; cursor: pointer; }
        .mode-tab.active { color: var(--p-red); border-bottom: 3px solid var(--p-red); }

        /* Wallet */
        .wallet-card { background: white; margin: 15px; border-radius: 20px; padding: 20px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }

        /* Number Buttons */
        .n-btn { height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; cursor: pointer; font-size: 18px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); }
        .n-red { background: var(--p-red); }
        .n-green { background: var(--p-green); }
        .n-0 { background: linear-gradient(135deg, var(--p-violet) 50%, var(--p-red) 50%); }
        .n-5 { background: linear-gradient(135deg, var(--p-violet) 50%, var(--p-green) 50%); }

        /* Result Popup Animation */
        #resultPopup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); background: white; width: 80%; padding: 30px; border-radius: 20px; z-index: 5000; text-align: center; box-shadow: 0 0 100px rgba(0,0,0,0.5); transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        #resultPopup.show { transform: translate(-50%, -50%) scale(1); }
        .win-text { color: #f3ad0c; font-size: 24px; font-weight: bold; }
        .loss-text { color: #999; font-size: 24px; font-weight: bold; }

        /* History Tables */
        .tab-box { display: flex; justify-content: space-around; margin: 20px 15px 10px; background: #eee; border-radius: 10px; padding: 5px; }
        .tab-btn { padding: 8px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; color: #777; }
        .tab-btn.active { background: white; color: var(--p-red); }
        
        .history-section { background: white; margin: 0 15px 20px; border-radius: 15px; overflow: hidden; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; text-align: center; }
        th { background: #fafafa; padding: 12px; color: #888; }
        td { padding: 12px; border-bottom: 1px solid #f1f1f1; }

        #bettingPanel { position: fixed; bottom: -100%; left: 0; width: 100%; background: white; z-index: 2000; border-radius: 25px 25px 0 0; transition: 0.4s; padding: 20px; box-sizing: border-box; }
        #bettingPanel.show { bottom: 0; }
    </style>
</head>
<body>

    <div id="resultOverlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:none; z-index:4999;"></div>
    <div id="resultPopup">
        <div id="popContent"></div>
        <button onclick="closePopup()" style="margin-top:20px; padding:10px 30px; border-radius:20px; border:none; background:var(--p-red); color:white;">Close</button>
    </div>

    <div class="header">
        <i class="fas fa-chevron-left"></i>
        <span>Win Go <span id="mDisp">1</span>Min</span>
        <i class="fas fa-headset"></i>
    </div>

    <div class="mode-tabs">
        <div class="mode-tab active" onclick="switchMode(1, this)">1Min</div>
        <div class="mode-tab" onclick="switchMode(3, this)">3Min</div>
        <div class="mode-tab" onclick="switchMode(5, this)">5Min</div>
    </div>

    <div class="wallet-card">
        <small style="color:#999;">Wallet Balance</small>
        <h2 id="uBalance" style="margin:10px 0;">₹0.00</h2>
        <div style="display:flex; gap:10px; justify-content:center;">
            <button onclick="location.href='deposit.html'" style="padding:8px 25px; border-radius:20px; border:none; background:var(--p-red); color:white;">Deposit</button>
            <button onclick="location.href='withdraw.html'" style="padding:8px 25px; border-radius:20px; border:1px solid #ddd; background:white;">Withdraw</button>
        </div>
    </div>

    <div style="background:white; margin:15px; padding:15px; border-radius:15px; display:flex; justify-content:space-between; align-items:center;">
        <div><small>Period</small><br><b id="periodId">20251229001</b></div>
        <div style="text-align:right;">
            <small>Time Remaining</small><br>
            <b id="timer" style="font-size:18px; color:#333;">00:00</b>
        </div>
    </div>

    <div style="margin:15px; background:white; padding:15px; border-radius:15px;">
        <div style="display:grid; grid-template-columns: repeat(5, 1fr); gap:10px;">
            <div onclick="openBet(0)" class="n-btn n-0">0</div>
            <div onclick="openBet(1)" class="n-btn n-green">1</div>
            <div onclick="openBet(2)" class="n-btn n-red">2</div>
            <div onclick="openBet(3)" class="n-btn n-green">3</div>
            <div onclick="openBet(4)" class="n-btn n-red">4</div>
            <div onclick="openBet(5)" class="n-btn n-5">5</div>
            <div onclick="openBet(6)" class="n-btn n-red">6</div>
            <div onclick="openBet(7)" class="n-btn n-green">7</div>
            <div onclick="openBet(8)" class="n-btn n-red">8</div>
            <div onclick="openBet(9)" class="n-btn n-green">9</div>
        </div>
    </div>

    <div class="tab-box">
        <div class="tab-btn active" onclick="showTab('game', this)">Game History</div>
        <div class="tab-btn" onclick="showTab('my', this)">My Bets</div>
    </div>

    <div class="history-section">
        <table id="gameHistoryTable">
            <thead><tr><th>Period</th><th>Number</th><th>Size</th><th>Color</th></tr></thead>
            <tbody id="gameHistoryList"></tbody>
        </table>
        <table id="myHistoryTable" style="display:none;">
            <thead><tr><th>Period</th><th>Bet</th><th>Amount</th><th>Status</th></tr></thead>
            <tbody id="myHistoryList"></tbody>
        </table>
    </div>

    <div id="bettingPanel">
        <h3 id="targetName" style="text-align:center;">Select</h3>
        <div style="display:flex; justify-content:space-between; margin:20px 0;">
            <span>Amount</span>
            <div style="display:flex; gap:10px;">
                <b onclick="setX(10)">₹10</b><b onclick="setX(100)">₹100</b><b onclick="setX(1000)">₹1k</b>
            </div>
        </div>
        <button onclick="confirmBet()" style="width:100%; padding:15px; border-radius:30px; border:none; background:var(--p-red); color:white; font-weight:bold;">Confirm ₹<span id="totalPrice">10</span></button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, push, get, query, limitToLast } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const fbConfig = { apiKey: "AIzaSyAeJutSnxBLtXKIFSZdUOvEwKRMdwLdaj8", databaseURL: "https://testing-26b8c-default-rtdb.firebaseio.com", projectId: "testing-26b8c" };
        const app = initializeApp(fbConfig);
        const db = getDatabase(app);
        const userPhone = localStorage.getItem('userPhone') || '9117748052';

        let currentMode = 1, currentBalance = 0, selected = "", betAmount = 10;

        // Timer Logic
        setInterval(() => {
            const now = new Date();
            const totalSec = (currentMode * 60) - (now.getMinutes() % currentMode * 60 + now.getSeconds());
            const m = Math.floor(totalSec / 60);
            const s = totalSec % 60;
            document.getElementById('timer').innerText = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
            
            if(totalSec === 1) checkResultAnimation();
            if(totalSec === (currentMode * 60)) refreshData();
        }, 1000);

        window.switchMode = (m, el) => {
            currentMode = m;
            document.querySelectorAll('.mode-tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            document.getElementById('mDisp').innerText = m;
            refreshData();
        };

        window.showTab = (tab, el) => {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
            document.getElementById('gameHistoryTable').style.display = tab === 'game' ? 'table' : 'none';
            document.getElementById('myHistoryTable').style.display = tab === 'my' ? 'table' : 'none';
        };

        // Result Animation & Check
        async function checkResultAnimation() {
            const lastBetSnap = await get(query(ref(db, `userBets/${userPhone}`), limitToLast(1)));
            if(!lastBetSnap.exists()) return;
            
            setTimeout(async () => {
                const gameRes = await get(query(ref(db, `wingoHistory/${currentMode}`), limitToLast(1)));
                const betData = Object.values(lastBetSnap.val())[0];
                const winData = Object.values(gameRes.val())[0];

                if(betData.period === winData.period) {
                    const isWin = (betData.type === winData.number); // Simplified for numbers
                    showPopup(isWin, isWin ? betData.amount * 9 : betData.amount);
                }
            }, 2000);
        }

        function showPopup(win, amt) {
            const content = win ? `<h2 class="win-text">Congratulations</h2><p>You won ₹${amt}</p>` : `<h2 class="loss-text">Try Again</h2><p>Better luck next time</p>`;
            document.getElementById('popContent').innerHTML = content;
            document.getElementById('resultOverlay').style.display = 'block';
            document.getElementById('resultPopup').classList.add('show');
        }

        window.closePopup = () => {
            document.getElementById('resultOverlay').style.display = 'none';
            document.getElementById('resultPopup').classList.remove('show');
        };

        // Betting & Data
        window.openBet = (t) => { selected = t; document.getElementById('targetName').innerText = "Select " + t; document.getElementById('bettingPanel').classList.add('show'); };
        window.setX = (a) => { betAmount = a; document.getElementById('totalPrice').innerText = a; };
        
        window.confirmBet = () => {
            if(betAmount > currentBalance) return alert("Low Balance");
            const period = document.getElementById('periodId').innerText;
            push(ref(db, `userBets/${userPhone}`), { period, type: selected, amount: betAmount, mode: currentMode, status: 'pending' });
            set(ref(db, `users/${userPhone}/balance`), currentBalance - betAmount);
            document.getElementById('bettingPanel').classList.remove('show');
            alert("Bet Success");
        };

        function refreshData() {
            // Load Game History
            onValue(query(ref(db, `wingoHistory/${currentMode}`), limitToLast(10)), snap => {
                const list = document.getElementById('gameHistoryList');
                list.innerHTML = "";
                snap.forEach(c => {
                    const d = c.val();
                    list.insertAdjacentHTML('afterbegin', `<tr><td>${d.period}</td><td>${d.number}</td><td>${d.number >= 5 ? 'Big' : 'Small'}</td><td>${d.color}</td></tr>`);
                    document.getElementById('periodId').innerText = parseInt(d.period) + 1;
                });
            });

            // Load My History
            onValue(query(ref(db, `userBets/${userPhone}`), limitToLast(10)), snap => {
                const list = document.getElementById('myHistoryList');
                list.innerHTML = "";
                snap.forEach(c => {
                    const d = c.val();
                    list.insertAdjacentHTML('afterbegin', `<tr><td>${d.period}</td><td>${d.type}</td><td>₹${d.amount}</td><td>${d.status}</td></tr>`);
                });
            });
        }

        onValue(ref(db, `users/${userPhone}/balance`), s => {
            currentBalance = s.val() || 0;
            document.getElementById('uBalance').innerText = `₹${currentBalance.toFixed(2)}`;
        });

        refreshData();
    </script>
</body>
</html>
