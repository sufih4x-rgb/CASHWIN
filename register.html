<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Register - CASHWIN</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --p-red: #ff6b6b; --g-red: linear-gradient(180deg, #ff8e8e 0%, #ff5252 100%); }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Arial', sans-serif; }
        body { background-color: #f8f9fe; padding-bottom: 50px; }
        .header { background: var(--g-red); height: 150px; padding: 20px; color: white; text-align: center; }
        .logo-text { font-size: 28px; font-weight: 900; color: #ffeb3b; font-style: italic; margin-bottom: 5px; }
        .container { background: white; margin: -30px 15px 0 15px; border-radius: 20px; padding: 25px 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); position: relative; }
        .form-title { text-align: center; font-weight: bold; color: #333; margin-bottom: 20px; font-size: 18px; border-bottom: 2px solid var(--p-red); display: inline-block; width: 100%; padding-bottom: 10px; }
        .input-box { display: flex; align-items: center; background: #fdfdfd; border: 1px solid #ddd; border-radius: 12px; padding: 5px 15px; margin-bottom: 15px; }
        .input-box i { color: var(--p-red); width: 20px; }
        input { flex: 1; border: none; padding: 12px; outline: none; font-size: 15px; background: transparent; }
        .btn-register { background: var(--g-red); color: white; width: 100%; padding: 15px; border: none; border-radius: 30px; font-size: 18px; font-weight: bold; margin-top: 10px; box-shadow: 0 5px 15px rgba(255,107,107,0.3); cursor: pointer; }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo-text">CASHWIN</div>
        <p>Create your professional account</p>
    </div>

    <div class="container">
        <div class="form-title">REGISTER</div>

        <div class="input-box">
            <i class="fas fa-envelope"></i>
            <input type="email" id="regEmail" placeholder="Enter Email Address">
        </div>

        <div class="input-box">
            <i class="fas fa-phone-alt"></i>
            <span style="font-weight:bold; margin:0 10px;">+91</span>
            <input type="number" id="regPhone" placeholder="Mobile Number">
        </div>

        <div class="input-box">
            <i class="fas fa-lock"></i>
            <input type="password" id="regPass" placeholder="Set Password">
        </div>

        <div class="input-box">
            <i class="fas fa-user-plus"></i>
            <input type="text" id="inviteCode" placeholder="Invite Code (Optional)">
        </div>

        <button class="btn-register" id="finalRegBtn">Register Now</button>
        
        <p style="text-align:center; margin-top:20px; font-size:14px;">
            Already have an account? <a href="login.html" style="color:var(--p-red); text-decoration:none; font-weight:bold;">Login</a>
        </p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, sendEmailVerification } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAeJutSnxBLtXKIFSZdUOvEwKRMdwLdaj8",
            authDomain: "testing-26b8c.firebaseapp.com",
            databaseURL: "https://testing-26b8c-default-rtdb.firebaseio.com",
            projectId: "testing-26b8c",
            appId: "1:546674600784:web:4b316bb716eda5f3b7da55"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        document.getElementById('finalRegBtn').onclick = async () => {
            const email = document.getElementById('regEmail').value;
            const phone = document.getElementById('regPhone').value;
            const pass = document.getElementById('regPass').value;
            const invite = document.getElementById('inviteCode').value || "Direct";

            // Basic Validation
            if(!email.includes('@')) return alert("Please enter a valid Email!");
            if(phone.length !== 10) return alert("Please enter 10-digit Mobile Number!");
            if(pass.length < 6) return alert("Password must be at least 6 characters!");

            try {
                // 1. Firebase Auth mein User create karo
                const userCred = await createUserWithEmailAndPassword(auth, email, pass);
                const user = userCred.user;

                // 2. Gmail par Verification Link bhejo
                await sendEmailVerification(user);
                
                // 3. Database mein user ka data 'Pending' status ke sath save karo
                // Hum UID ko key banayenge taaki unique rahe
                await set(ref(db, 'users/' + user.uid), {
                    uid: user.uid,
                    email: email,
                    phone: phone,
                    password: pass, // Optional: Security ke liye save na karein toh behtar hai
                    balance: 0,
                    status: 'pending_verification',
                    referredBy: invite,
                    emailVerified: false,
                    joinDate: new Date().toLocaleString()
                });

                alert("Success! A verification link has been sent to " + email + ". Please verify your email to activate your account.");
                window.location.href = "login.html";

            } catch (error) {
                console.error(error);
                alert("Error: " + error.message);
            }
        };
    </script>
</body>
</html>
