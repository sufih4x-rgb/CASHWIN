<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>CASHWIN - Home</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary-red: #ff6b6b; --gradient-red: linear-gradient(180deg, #ff8e8e 0%, #ff5252 100%); --bg-light: #f8f9fe; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background-color: var(--bg-light); padding-bottom: 90px; }

        /* Security: Hide body initially */
        #main-dashboard { display: none; }

        /* Banner Slider */
        .slider-container { margin: 15px; border-radius: 20px; overflow: hidden; height: 160px; position: relative; box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .slider { display: flex; transition: transform 0.8s ease-in-out; height: 100%; }
        .slider img { min-width: 100%; object-fit: cover; }

        /* Deposit Bonus Board */
        .bonus-board { background: #fffde7; margin: 15px; padding: 12px; border-radius: 15px; border: 1px dashed #fbc02d; font-size: 12px; color: #856404; display: flex; align-items: center; gap: 10px; }
        
        /* Layout Fixes */
        .top-header { background: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .wallet-box { background: #fff5f5; padding: 8px 15px; border-radius: 20px; border: 1px solid var(--primary-red); color: var(--primary-red); font-weight: bold; }
        
        .floating-chat { position: fixed; bottom: 100px; right: 20px; width: 60px; height: 60px; border-radius: 50%; background: var(--gradient-red); color: white; display: flex; justify-content: center; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 3000; cursor: pointer; }
        .status-dot { position: absolute; top: 5px; right: 5px; width: 12px; height: 12px; border-radius: 50%; border: 2px solid white; background: #ccc; }
        .status-dot.online { background: #4cd964; box-shadow: 0 0 10px #4cd964; }

        .game-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 0 15px; }
        .game-card { background: white; border-radius: 15px; overflow: hidden; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .game-card img { width: 100%; aspect-ratio: 1/1; object-fit: cover; }
        .game-card p { font-size: 11px; padding: 8px 2px; font-weight: 600; }

        .section-title { font-size: 16px; font-weight: bold; margin: 20px 15px 10px; display: flex; align-items: center; gap: 8px; }
        .section-title i { color: var(--primary-red); }

        /* Bottom Nav */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #eee; z-index: 1000; }
        .nav-item { text-align: center; color: #999; text-decoration: none; font-size: 12px; }
        .nav-item.active { color: var(--primary-red); }
        .nav-item i { display: block; font-size: 22px; margin-bottom: 3px; }
    </style>
</head>
<body>

<div id="main-dashboard">
    <div class="top-header">
        <h2 style="font-style: italic; color: var(--primary-red);">CASHWIN</h2>
        <div class="wallet-box">₹<span id="userBalance">0.00</span></div>
    </div>

    <div class="slider-container">
        <div class="slider" id="mainSlider">
            <img src="https://via.placeholder.com/400x160?text=Welcome+to+CashWin">
        </div>
    </div>

    <div class="bonus-board">
        <i class="fas fa-gift fa-2x"></i>
        <div>
            <b>Daily Bonus:</b> Dep ₹200 (+₹20), ₹300 (+₹40), ₹600 (+₹80), ₹900 (+₹100).
        </div>
    </div>

    <div class="section-title"><i class="fas fa-fire"></i> Popular Games</div>
    <div class="game-grid">
        <div class="game-card" onclick="location.href='wingo.html'"><img src="https://i.ibb.co/v6mYvXf/wingo.jpg"><p>WinGo 1M</p></div>
        <div class="game-card" onclick="location.href='mines.html'"><img src="https://i.ibb.co/v6mYvXf/mines.jpg"><p>Mines Pro</p></div>
        <div class="game-card" onclick="location.href='plinko.html'"><img src="https://i.ibb.co/v6mYvXf/plinko.jpg"><p>Plinko</p></div>
    </div>

    <div class="section-title"><i class="fas fa-dice"></i> Premium Slots (20+)</div>
    <div class="game-grid" id="slotGrid">
        </div>

    <div class="floating-chat" onclick="window.open('https://t.me/your_admin', '_blank')">
        <div id="adminStatus" class="status-dot"></div>
        <i class="fas fa-headset fa-lg"></i>
    </div>

    <nav class="bottom-nav">
        <a href="dashboard.html" class="nav-item active"><i class="fas fa-home"></i>Home</a>
        <a href="promotion.html" class="nav-item"><i class="fas fa-gift"></i>Gift</a>
        <a href="invite.html" class="nav-item"><i class="fas fa-share-alt"></i>Invite</a>
        <a href="profile.html" class="nav-item"><i class="fas fa-user"></i>Account</a>
    </nav>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = { 
        apiKey: "AIzaSyAeJutSnxBLtXKIFSZdUOvEwKRMdwLdaj8",
        databaseURL: "https://testing-26b8c-default-rtdb.firebaseio.com",
        projectId: "testing-26b8c"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const userPhone = localStorage.getItem('userPhone');

    // 1. LOGIN PROTECTION
    if (!userPhone) {
        window.location.href = "register.html";
    } else {
        document.getElementById('main-dashboard').style.display = 'block';
    }

    // 2. ADMIN SLIDER (Auto-scroll 30s)
    const slider = document.getElementById('mainSlider');
    onValue(ref(db, 'adminControl/banners'), (snap) => {
        const banners = snap.val(); // Expecting array of 10 links
        if(banners) {
            slider.innerHTML = banners.map(url => `<img src="${url}">`).join('');
        }
    });

    let slideIdx = 0;
    setInterval(() => {
        const slides = slider.querySelectorAll('img');
        if(slides.length > 0) {
            slideIdx = (slideIdx + 1) % slides.length;
            slider.style.transform = `translateX(-${slideIdx * 100}%)`;
        }
    }, 30000); // 30 seconds

    // 3. ADMIN ONLINE STATUS
    onValue(ref(db, 'adminControl/status'), (snap) => {
        const status = snap.val();
        document.getElementById('adminStatus').className = (status === 'online') ? 'status-dot online' : 'status-dot';
    });

    // 4. LOAD 20 SLOTS (3 per row)
    const slotGrid = document.getElementById('slotGrid');
    for(let i=1; i<=20; i++) {
        slotGrid.innerHTML += `
            <div class="game-card" onclick="location.href='slot${i}.html'">
                <img src="https://picsum.photos/200?random=${i+10}">
                <p>Slot Game ${i}</p>
            </div>`;
    }

    // 5. USER SYNC (Balance & Ban)
    onValue(ref(db, 'users/' + userPhone), (snap) => {
        const data = snap.val();
        if(!data || data.status === 'banned') {
            localStorage.clear();
            window.location.href = "login.html";
            return;
        }
        document.getElementById('userBalance').innerText = parseFloat(data.balance).toFixed(2);
    });

</script>
</body>
</html>
