<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CASHWIN - Game Control</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #ff6b6b; --sidebar-bg: #1a1c23; --main-bg: #f4f7fe; --white: #ffffff; --text-muted: #8492a6; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: var(--main-bg); display: flex; min-height: 100vh; }

        .sidebar { width: 260px; background: var(--sidebar-bg); color: white; padding: 25px 0; position: fixed; height: 100vh; z-index: 100; }
        .sidebar-brand { padding: 0 25px 30px; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px; }
        .sidebar-brand h2 { color: var(--primary); font-style: italic; letter-spacing: 1px; }
        .nav-link { display: flex; align-items: center; padding: 12px 25px; color: #a0aec0; text-decoration: none; transition: 0.3s; gap: 12px; font-size: 14px; }
        .nav-link:hover, .nav-link.active { background: rgba(255,107,107,0.1); color: var(--primary); border-right: 4px solid var(--primary); }

        .main-content { margin-left: 260px; width: calc(100% - 260px); padding: 30px; }
        .top-header { background: var(--white); padding: 20px 30px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 12px rgba(0,0,0,0.03); margin-bottom: 30px; }
        
        .category-card { background: var(--white); padding: 25px; border-radius: 20px; margin-bottom: 30px; box-shadow: 0 10px 25px rgba(0,0,0,0.02); }
        .category-title { font-size: 18px; font-weight: 600; color: #2d3748; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }

        .game-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .game-edit-box { border: 1px solid #edf2f7; padding: 20px; border-radius: 15px; background: #f8fafc; transition: 0.3s; text-align: center; }
        
        .preview-img { width: 80px; height: 80px; object-fit: cover; border-radius: 10px; margin-bottom: 10px; border: 2px solid #ddd; background: #eee; }
        
        label { font-size: 11px; font-weight: bold; color: #4a5568; display: block; margin-bottom: 5px; text-align: left; }
        input[type="text"] { width: 100%; padding: 10px; margin-bottom: 12px; border: 1px solid #e2e8f0; border-radius: 8px; outline: none; }
        input[type="file"] { font-size: 11px; margin-bottom: 15px; width: 100%; }

        .btn-update { background: var(--primary); color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer; font-weight: 600; width: 100%; font-size: 13px; }
        
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1a1c23; z-index: 10000; display: flex; align-items: center; justify-content: center; }
        .login-box { background: white; padding: 40px; border-radius: 25px; text-align: center; width: 400px; }
        .toast { position: fixed; bottom: 20px; right: 20px; background: #2d3748; color: white; padding: 12px 25px; border-radius: 10px; display: none; z-index: 11000; }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="login-box">
        <i class="fas fa-lock" style="font-size:40px; color:var(--primary); margin-bottom:20px;"></i>
        <h2>Admin Login</h2>
        <input type="password" id="adminPass" placeholder="Enter Password" style="width:100%; padding:12px; margin:20px 0; border-radius:10px; border:1px solid #ddd; text-align:center;">
        <button class="btn-update" onclick="checkAuth()">LOGIN</button>
    </div>
</div>

<div class="sidebar">
    <div class="sidebar-brand"><h2>CASHWIN</h2></div>
    <a href="admin.html" class="nav-link"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
    <a href="#" class="nav-link active"><i class="fas fa-image"></i> Game Images</a>
    <a href="admin.html" class="nav-link" style="margin-top:200px;"><i class="fas fa-arrow-left"></i> Back</a>
</div>

<div class="main-content">
    <div class="top-header">
        <h1>Game Content Manager</h1>
        <p>Password: <b>admin123</b></p>
    </div>

    <div class="category-card">
        <div class="category-title"><i class="fas fa-upload"></i> Popular Games</div>
        <div class="game-grid" id="popularGrid"></div>
    </div>

    <div class="category-card">
        <div class="category-title"><i class="fas fa-bolt"></i> Hot Games</div>
        <div class="game-grid" id="hotGrid"></div>
    </div>
</div>

<div id="toast" class="toast">Action Successful!</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = { databaseURL: "https://testing-26b8c-default-rtdb.firebaseio.com" };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const FIXED_PASS = "admin123";

    window.checkAuth = () => {
        if(document.getElementById('adminPass').value === FIXED_PASS){
            document.getElementById('loginOverlay').style.display = 'none';
            loadEditors();
        } else { alert("Wrong Password!"); }
    };

    function loadEditors() {
        ['popular', 'hot'].forEach(cat => {
            const grid = document.getElementById(cat + 'Grid');
            grid.innerHTML = "";
            for(let i=1; i<=10; i++){
                const box = document.createElement('div');
                box.className = 'game-edit-box';
                box.innerHTML = `
                    <h4>Slot #${i}</h4>
                    <img id="prev_${cat}_${i}" class="preview-img" src="">
                    <label>Upload Game Image</label>
                    <input type="file" id="file_${cat}_${i}" accept="image/*" onchange="previewFile('${cat}', ${i})">
                    <label>Game Title</label>
                    <input type="text" id="name_${cat}_${i}" placeholder="Game Name">
                    <label>Redirect URL</label>
                    <input type="text" id="link_${cat}_${i}" placeholder="wingo.html">
                    <button class="btn-update" onclick="uploadAndSave('${cat}', ${i})">SAVE DATA</button>
                `;
                grid.appendChild(box);

                onValue(ref(db, `admin/games/${cat}/game_${i}`), (snap) => {
                    const d = snap.val();
                    if(d) {
                        document.getElementById(`name_${cat}_${i}`).value = d.name || "";
                        document.getElementById(`link_${cat}_${i}`).value = d.link || "";
                        document.getElementById(`prev_${cat}_${i}`).src = d.image || "";
                    }
                });
            }
        });
    }

    // Preview image before saving
    window.previewFile = (cat, i) => {
        const file = document.getElementById(`file_${cat}_${i}`).files[0];
        const reader = new FileReader();
        reader.onloadend = () => { document.getElementById(`prev_${cat}_${i}`).src = reader.result; };
        if (file) reader.readAsDataURL(file);
    };

    // Save Name, Link and Image (Base64) to Firebase
    window.uploadAndSave = (cat, i) => {
        const name = document.getElementById(`name_${cat}_${i}`).value;
        const link = document.getElementById(`link_${cat}_${i}`).value;
        const imageData = document.getElementById(`prev_${cat}_${i}`).src;

        if(!name || !imageData) return showToast("Name & Image required!", "red");

        set(ref(db, `admin/games/${cat}/game_${i}`), {
            name: name,
            link: link || "wingo.html",
            image: imageData
        }).then(() => showToast(`Slot ${i} Updated!`));
    };

    function showToast(m, c="#2ecc71") {
        const t = document.getElementById('toast');
        t.innerText = m; t.style.background = c; t.style.display = 'block';
        setTimeout(() => t.style.display = 'none', 3000);
    }
</script>
</body>
</html>
