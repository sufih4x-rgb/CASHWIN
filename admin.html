<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CASHWIN - Master Control Center v5</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #1a1c2c; --accent: #ff4757; --success: #2ed573; --bg: #f1f2f6; --blue: #1e90ff; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg); display: flex; height: 100vh; overflow: hidden; }

        /* Login Overlay */
        #loginOverlay { position: fixed; inset: 0; background: var(--primary); z-index: 10000; display: flex; align-items: center; justify-content: center; color: white; }
        .login-card { background: white; padding: 40px; border-radius: 20px; width: 350px; color: #333; text-align: center; }

        /* Sidebar */
        .sidebar { width: 260px; background: var(--primary); color: white; padding: 20px; flex-shrink: 0; display: flex; flex-direction: column; }
        .sidebar h2 { color: var(--accent); margin-bottom: 30px; text-align: center; }
        .nav-link { padding: 12px; color: #ced6e0; text-decoration: none; border-radius: 8px; margin-bottom: 5px; cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 10px; }
        .nav-link.active, .nav-link:hover { background: rgba(255,255,255,0.1); color: white; }

        /* Main Content */
        .main-content { flex: 1; overflow-y: auto; padding: 30px; }
        .header-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 12px; border-bottom: 4px solid var(--accent); }

        .section { display: none; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .section.active { display: block; }

        /* UI Elements */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; font-size: 13px; }
        .btn { padding: 6px 12px; border: none; border-radius: 5px; cursor: pointer; color: white; font-weight: bold; }
        .btn-green { background: var(--success); }
        .btn-red { background: var(--accent); }
        .btn-blue { background: var(--blue); }
        
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-size: 12px; font-weight: bold; margin-bottom: 5px; }
        .input-group input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; }
        
        .qr-config-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }
        .slider-item { background: #f9f9f9; padding: 15px; border-radius: 10px; border: 1px solid #eee; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <div class="login-card">
            <h2>Admin Secure Login</h2>
            <input type="password" id="adminPass" style="width:100%; padding:10px; margin:20px 0;" placeholder="Enter Password">
            <button class="btn btn-blue" style="width:100%; padding:12px;" onclick="checkLogin()">Login</button>
        </div>
    </div>

    <div class="sidebar">
        <h2>CASHWIN</h2>
        <div class="nav-link active" onclick="showSection('dashboard')"><i class="fas fa-home"></i> Dashboard</div>
        <div class="nav-link" onclick="showSection('users')"><i class="fas fa-user-shield"></i> User Control</div>
        <div class="nav-link" onclick="showSection('transactions')"><i class="fas fa-exchange-alt"></i> Requests</div>
        <div class="nav-link" onclick="showSection('paymentConfig')"><i class="fas fa-university"></i> Payment/QR</div>
        <div class="nav-link" onclick="showSection('slider')"><i class="fas fa-ad"></i> Banners & Links</div>
    </div>

    <div class="main-content">
        <div class="header-stats">
            <div class="stat-card"><h3>Profit</h3><h2 id="profitTag">₹0</h2></div>
            <div class="stat-card"><h3>Live Users</h3><h2 id="userCount">0</h2></div>
            <div class="stat-card"><h3>System</h3><h2 id="statusTag" style="color:gray">OFFLINE</h2></div>
            <div class="stat-card"><h3>Pending</h3><h2 id="pendingTag">0</h2></div>
        </div>

        <div id="dashboard" class="section active">
            <h2>Live Betting Monitor</h2>
            <table><thead><tr><th>User</th><th>Game</th><th>Amount</th><th>Type</th><th>Outcome</th></tr></thead><tbody id="liveBetsBody"></tbody></table>
        </div>

        <div id="users" class="section">
            <h2>User Management</h2>
            <table><thead><tr><th>Phone</th><th>Balance</th><th>Rigging</th><th>Status</th><th>Manage</th></tr></thead><tbody id="userTableBody"></tbody></table>
        </div>

        <div id="transactions" class="section">
            <h2>Transaction Requests</h2>
            <div style="margin-bottom:20px;">
                <button class="btn btn-blue" onclick="loadRequests('deposits')">Deposit Requests</button>
                <button class="btn btn-blue" style="background:#f39c12" onclick="loadRequests('withdrawals')">Withdrawal Requests</button>
            </div>
            <table><thead id="reqHead"></thead><tbody id="reqBody"></tbody></table>
        </div>

        <div id="paymentConfig" class="section">
            <h2>Payment QR & UPI Settings</h2>
            <div class="qr-config-grid">
                <div class="slider-item">
                    <h4>PhonePe</h4>
                    <input type="text" id="upi_pe" placeholder="UPI ID"><br><br>
                    <input type="text" id="qr_pe" placeholder="QR Image URL">
                </div>
                <div class="slider-item">
                    <h4>Paytm</h4>
                    <input type="text" id="upi_tm" placeholder="UPI ID"><br><br>
                    <input type="text" id="qr_tm" placeholder="QR Image URL">
                </div>
                <div class="slider-item">
                    <h4>Merchant/All-in-One</h4>
                    <input type="text" id="upi_all" placeholder="UPI ID"><br><br>
                    <input type="text" id="qr_all" placeholder="QR Image URL">
                </div>
            </div>
            <button class="btn btn-green" style="width:100%; margin-top:20px; padding:15px;" onclick="savePayment()">SAVE SETTINGS</button>
        </div>

        <div id="slider" class="section">
            <h2>App Banner Sliders (Image + Redirect)</h2>
            <div id="sliderInputs">
                </div>
            <button class="btn btn-blue" style="width:100%; margin-top:20px; padding:15px;" onclick="saveSliders()">UPDATE BANNERS</button>
        </div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, update, increment, onDisconnect } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const fbConfig = { databaseURL: "https://testing-26b8c-default-rtdb.firebaseio.com" };
    const app = initializeApp(fbConfig);
    const db = getDatabase(app);

    // Login & Online Status
    window.checkLogin = () => {
        if(document.getElementById('adminPass').value === "admin123") {
            document.getElementById('loginOverlay').style.display = 'none';
            set(ref(db, 'admin_settings/isOnline'), true);
            document.getElementById('statusTag').innerText = "ONLINE";
            document.getElementById('statusTag').style.color = "#2ed573";
        } else { alert("Wrong Password!"); }
    };
    onDisconnect(ref(db, 'admin_settings/isOnline')).set(false);

    window.showSection = (id) => {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    };

    // Users Logic
    onValue(ref(db, 'users'), (snap) => {
        const body = document.getElementById('userTableBody'); body.innerHTML = "";
        let count = 0;
        snap.forEach(c => {
            const u = c.val(); count++;
            body.innerHTML += `<tr>
                <td>${u.phone}</td>
                <td>₹${(u.balance||0).toFixed(2)}</td>
                <td>
                    <button class="btn btn-green" onclick="setRig('${u.phone}','win')">W</button>
                    <button class="btn btn-red" onclick="setRig('${u.phone}','loss')">L</button>
                    <button class="btn btn-blue" onclick="setRig('${u.phone}','normal')">N</button>
                    <small>(${u.rig||'N'})</small>
                </td>
                <td><span style="color:${u.status==='banned'?'red':'green'}">${u.status||'active'}</span></td>
                <td>
                    <button class="btn btn-red" onclick="banUser('${u.phone}','${u.status}')">Ban/Unban</button>
                    <input type="number" id="bal_${u.phone}" style="width:50px" placeholder="+/-">
                    <button class="btn btn-green" onclick="addBal('${u.phone}')">OK</button>
                </td>
            </tr>`;
        });
        document.getElementById('userCount').innerText = count;
    });

    window.setRig = (ph, val) => update(ref(db, `users/${ph}`), { rig: val });
    window.banUser = (ph, cur) => update(ref(db, `users/${ph}`), { status: cur==='banned'?'active':'banned' });
    window.addBal = (ph) => {
        const amt = parseFloat(document.getElementById('bal_'+ph).value);
        if(amt) update(ref(db, `users/${ph}`), { balance: increment(amt) });
    };

    // Requests (Deposits & Withdrawals)
    window.loadRequests = (type) => {
        const head = document.getElementById('reqHead');
        const body = document.getElementById('reqBody');
        body.innerHTML = "Fetching...";
        
        onValue(ref(db, type), (snap) => {
            body.innerHTML = "";
            if(type === 'deposits') {
                head.innerHTML = "<tr><th>User</th><th>Amount</th><th>UTR</th><th>Action</th></tr>";
                snap.forEach(u => u.forEach(d => {
                    const req = d.val();
                    if(req.status === 'pending') {
                        body.innerHTML += `<tr><td>${req.phone}</td><td>₹${req.amount}</td><td>${req.utr}</td>
                        <td>
                            <button class="btn btn-green" onclick="handleDep('${req.phone}','${d.key}',${req.amount},'success')">Approve</button>
                            <button class="btn btn-red" onclick="handleDep('${req.phone}','${d.key}',0,'rejected')">Reject</button>
                        </td></tr>`;
                    }
                }));
            } else {
                head.innerHTML = "<tr><th>User</th><th>Amount</th><th>Method</th><th>Action</th></tr>";
                snap.forEach(u => u.forEach(w => {
                    const req = w.val();
                    if(req.status === 'pending') {
                        body.innerHTML += `<tr><td>${req.phone}</td><td>₹${req.amount}</td><td>${req.upi||'Bank'}</td>
                        <td>
                            <button class="btn btn-green" onclick="handleWith('${req.phone}','${w.key}','success')">Paid</button>
                            <button class="btn btn-red" onclick="handleWith('${req.phone}','${w.key}','refund')">Refund</button>
                        </td></tr>`;
                    }
                }));
            }
        });
    };

    window.handleDep = (ph, id, amt, stat) => {
        update(ref(db, `deposits/${ph}/${id}`), { status: stat });
        if(stat === 'success') update(ref(db, `users/${ph}`), { balance: increment(amt) });
    };

    window.handleWith = (ph, id, stat) => {
        if(stat === 'refund') {
            onValue(ref(db, `withdrawals/${ph}/${id}`), snap => {
                const amt = snap.val().amount;
                update(ref(db, `users/${ph}`), { balance: increment(amt) });
            }, {onlyOnce: true});
        }
        update(ref(db, `withdrawals/${ph}/${id}`), { status: stat });
    };

    // Slider System
    const slideInp = document.getElementById('sliderInputs');
    for(let i=1; i<=3; i++) {
        slideInp.innerHTML += `
            <div class="slider-item">
                <label>Slide ${i} Image URL:</label><input type="text" id="s_img_${i}">
                <label>Slide ${i} Redirect URL (Link):</label><input type="text" id="s_link_${i}">
            </div>`;
    }

    window.saveSliders = () => {
        // Sirf first slide update karke testing ke liye set karein
        const data = { 
            image: document.getElementById('s_img_1').value, 
            link: document.getElementById('s_link_1').value 
        };
        set(ref(db, 'admin_settings/slider'), data).then(() => alert("Banners Updated!"));
    };

    window.savePayment = () => {
        set(ref(db, 'admin_settings/payments'), {
            phonepe: { upi: document.getElementById('upi_pe').value, qr: document.getElementById('qr_pe').value },
            paytm: { upi: document.getElementById('upi_tm').value, qr: document.getElementById('qr_tm').value },
            merchant: { upi: document.getElementById('upi_all').value, qr: document.getElementById('qr_all').value }
        }).then(() => alert("Payment Info Saved!"));
    };

</script>
</body>
</html>
