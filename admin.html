<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CASHWIN - Admin Control Center</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --neon-red: #ff3131; --neon-green: #00ff41; --neon-blue: #00d4ff; --neon-violet: #bc13fe;
            --dark-bg: #0b0e14; --card-bg: #161b22; --text-gray: #8b949e;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--dark-bg); color: white; display: flex; overflow-x: hidden; }

        /* Sidebar */
        .sidebar { width: 280px; height: 100vh; background: var(--card-bg); position: fixed; border-right: 1px solid #30363d; padding: 20px; z-index: 100; }
        .logo { font-size: 28px; font-weight: 900; color: var(--neon-red); text-shadow: 0 0 10px var(--neon-red); margin-bottom: 40px; text-align: center; }
        .nav-item { padding: 12px; margin-bottom: 10px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; gap: 12px; transition: 0.3s; color: var(--text-gray); }
        .nav-item:hover, .nav-item.active { background: rgba(255, 49, 49, 0.1); color: white; border-left: 4px solid var(--neon-red); }

        /* Main Content */
        .main { margin-left: 280px; width: 100%; padding: 30px; }

        /* Admin Lock Screen */
        #adminLock { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--dark-bg); z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .lock-box { background: var(--card-bg); padding: 40px; border-radius: 20px; text-align: center; border: 1px solid var(--neon-red); }
        .lock-input { padding: 12px; width: 250px; border-radius: 5px; border: 1px solid #30363d; background: #0b0e14; color: white; margin-bottom: 20px; text-align: center; }

        /* Sections */
        .wingo-section { background: var(--card-bg); padding: 25px; border-radius: 20px; margin-bottom: 30px; border: 1px solid #30363d; }
        
        /* Stats Cards */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--card-bg); padding: 20px; border-radius: 15px; border: 1px solid #30363d; border-bottom: 3px solid var(--neon-blue); }
        .stat-card .val { font-size: 24px; font-weight: bold; margin-top: 10px; }

        /* Buttons (Preserving Old Glowing Styles) */
        .btn-group { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
        .force-btn { padding: 15px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; text-transform: uppercase; transition: 0.3s; color: white; }
        .btn-green { background: #00c853; box-shadow: 0 0 15px rgba(0, 200, 83, 0.4); }
        .btn-red { background: #ff1744; box-shadow: 0 0 15px rgba(255, 23, 68, 0.4); }
        .btn-violet { background: #aa00ff; box-shadow: 0 0 15px rgba(170, 0, 255, 0.4); }
        .btn-orange { background: #ff9100; box-shadow: 0 0 15px rgba(255, 145, 0, 0.4); }

        /* Number Buttons */
        .num-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-top: 15px; }
        .n-btn { background: #30363d; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; }
        .n-btn:hover { background: var(--neon-blue); color: black; }

        /* Tables */
        .data-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .data-table th, .data-table td { padding: 15px; text-align: left; border-bottom: 1px solid #30363d; font-size: 14px; }
        .data-table th { color: var(--text-gray); background: #21262d; }

        /* QR Upload Preview */
        .qr-preview { width: 150px; height: 150px; border: 2px dashed var(--text-gray); margin-top: 10px; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .qr-preview img { width: 100%; height: 100%; object-fit: contain; }
    </style>
</head>
<body>

<div id="adminLock">
    <div class="lock-box">
        <div class="logo">CASHWIN ADMIN</div>
        <input type="password" id="adminPass" class="lock-input" placeholder="Enter Admin Security Key">
        <br>
        <button class="force-btn btn-red" onclick="unlockAdmin()" style="width: 100%;">Unlock System</button>
        <p style="margin-top: 20px; font-size: 12px; color: #666; cursor: pointer; text-decoration: underline;" onclick="resetRequest()">Forgot Password? Contact Developer</p>
    </div>
</div>

<div class="sidebar">
    <div class="logo">CASHWIN</div>
    <div class="nav-item active"><i class="fas fa-home"></i> Dashboard</div>
    <div class="nav-item"><i class="fas fa-gamepad"></i> Wingo Control</div>
    <div class="nav-item"><i class="fas fa-users"></i> Users Hub</div>
    <div class="nav-item"><i class="fas fa-wallet"></i> Deposits (UTR)</div>
    <div class="nav-item"><i class="fas fa-university"></i> Withdrawals</div>
    <div class="nav-item"><i class="fas fa-cog"></i> Settings</div>
</div>

<div class="main">
    <div class="stats-grid">
        <div class="stat-card">Weekly Deposit<div class="val" id="weekDep">₹0</div></div>
        <div class="stat-card">Weekly Withdraw<div class="val" id="weekWith">₹0</div></div>
        <div class="stat-card">Live Users<div class="val" id="liveUsersCount">0</div></div>
        <div class="stat-card">Admin Profit<div class="val" style="color:var(--neon-green)">₹0</div></div>
    </div>

    <div class="wingo-section">
        <h3><i class="fas fa-magic"></i> Wingo 1/3/5m Prediction Engine</h3>
        <div style="margin-top: 10px;">
            Timer: <select id="gameTimer" style="background:#0b0e14; color:white; padding:5px; border-radius:5px;">
                <option value="1">1 Minute</option><option value="3">3 Minute</option><option value="5">5 Minute</option>
            </select>
        </div>
        <div class="btn-group">
            <button class="force-btn btn-green" onclick="forceColor('green')">Green</button>
            <button class="force-btn btn-violet" onclick="forceColor('violet')">Violet</button>
            <button class="force-btn btn-red" onclick="forceColor('red')">Red</button>
            <button class="force-btn btn-orange" onclick="forceSize('big')">Big (5-9)</button>
            <button class="force-btn btn-orange" onclick="forceSize('small')">Small (0-4)</button>
        </div>
        <div class="num-grid">
            <button class="n-btn" onclick="forceNum(0)">0 (V)</button>
            <button class="n-btn" onclick="forceNum(1)">1</button>
            <button class="n-btn" onclick="forceNum(2)">2</button>
            <button class="n-btn" onclick="forceNum(3)">3</button>
            <button class="n-btn" onclick="forceNum(4)">4</button>
            <button class="n-btn" onclick="forceNum(5)">5 (V)</button>
            <button class="n-btn" onclick="forceNum(6)">6</button>
            <button class="n-btn" onclick="forceNum(7)">7</button>
            <button class="n-btn" onclick="forceNum(8)">8</button>
            <button class="n-btn" onclick="forceNum(9)">9</button>
        </div>
        <button class="force-btn" style="background:gray; margin-top:15px; width:100%;" onclick="resetAuto()">Reset to Automatic Mode</button>
    </div>

    <div class="wingo-section">
        <h3><i class="fas fa-qrcode"></i> Change Deposit QR Code</h3>
        <div class="qr-preview" id="qrContainer">
            <img id="currentQR" src="https://via.placeholder.com/150?text=No+QR+Set" alt="QR Preview">
        </div>
        <input type="file" id="qrInput" accept="image/*" style="margin-top: 15px; color: var(--text-gray);">
        <button class="force-btn btn-green" style="margin-top: 10px;" onclick="uploadQR()">Update QR & UPI ID</button>
        <input type="text" id="upiIdInp" placeholder="Enter UPI ID (e.g. upi@okaxis)" class="lock-input" style="width:100%; margin-top:10px;">
    </div>

    <div class="wingo-section">
        <h3>Withdrawal Requests (Verify Bank/UPI)</h3>
        <table class="data-table">
            <thead><tr><th>User</th><th>Amount</th><th>UPI/Bank Details</th><th>Action</th></tr></thead>
            <tbody id="withTableBody"></tbody>
        </table>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, update, onValue, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAeJutSnxBLtXKIFSZdUOvEwKRMdwLdaj8",
        authDomain: "testing-26b8c.firebaseapp.com",
        databaseURL: "https://testing-26b8c-default-rtdb.firebaseio.com",
        projectId: "testing-26b8c",
        storageBucket: "testing-26b8c.firebasestorage.app",
        messagingSenderId: "546674600784",
        appId: "1:546674600784:web:4b316bb716eda5f3b7da55"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // --- Unlock & Security ---
    window.unlockAdmin = () => {
        const pass = document.getElementById('adminPass').value;
        if(pass === "CASHWIN786") {
            document.getElementById('adminLock').style.display = 'none';
        } else { alert("Access Denied!"); }
    }

    window.resetRequest = () => {
        alert("Reset notification sent to: sufih4x@gmail.com");
    }

    // --- Wingo Master Logic (Big/Small/Violet) ---
    window.forceNum = (n) => {
        const timer = document.getElementById('gameTimer').value;
        let color = (n === 0 || n === 5) ? "Violet" : (n % 2 === 0 ? "Red" : "Green");
        let size = (n <= 4) ? "Small" : "Big";
        update(ref(db, `admin/wingo/${timer}m`), { forcedNum: n, forcedColor: color, forcedSize: size, mode: "Manual" });
        alert(`Next Result: ${n} (${color} - ${size})`);
    }

    window.forceColor = (c) => {
        const timer = document.getElementById('gameTimer').value;
        update(ref(db, `admin/wingo/${timer}m`), { forcedColor: c, mode: "Manual" });
        alert(`Next Color Forced: ${c}`);
    }

    window.forceSize = (s) => {
        const timer = document.getElementById('gameTimer').value;
        update(ref(db, `admin/wingo/${timer}m`), { forcedSize: s, mode: "Manual" });
        alert(`Next Size Forced: ${s}`);
    }

    window.resetAuto = () => {
        const timer = document.getElementById('gameTimer').value;
        update(ref(db, `admin/wingo/${timer}m`), { mode: "Auto" });
        alert("System Reset to Automatic");
    }

    // --- QR & UPI Update Logic ---
    window.uploadQR = () => {
        const upi = document.getElementById('upiIdInp').value;
        const file = document.getElementById('qrInput').files[0];
        if(!upi) return alert("Please enter UPI ID first!");
        
        // Base64 conversion for small QR images (Real Storage recommended later)
        if(file) {
            const reader = new FileReader();
            reader.onloadend = () => {
                update(ref(db, 'admin/settings/payment'), {
                    qrCode: reader.result,
                    upiId: upi
                });
                document.getElementById('currentQR').src = reader.result;
                alert("QR & UPI Updated Successfully!");
            }
            reader.readAsDataURL(file);
        } else {
            update(ref(db, 'admin/settings/payment'), { upiId: upi });
            alert("UPI ID Updated!");
        }
    }

    // Fetch Current QR
    onValue(ref(db, 'admin/settings/payment'), (snap) => {
        if(snap.exists()){
            const data = snap.val();
            if(data.qrCode) document.getElementById('currentQR').src = data.qrCode;
            if(data.upiId) document.getElementById('upiIdInp').value = data.upiId;
        }
    });

</script>
</body>
</html>
